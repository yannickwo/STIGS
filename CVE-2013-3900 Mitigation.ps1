<#
.SYNOPSIS
    This PowerShell script Add and enable registry value EnableCertPaddingCheck (32-bit & 64-bit).

.NOTES
    Author          : Yannick Wona
    LinkedIn        : linkedin.com/in/yanne-k-3bb065b9/
    GitHub          : github.com/yannickwo
    Date Created    : 2024-12-03
    Last Modified   : 2024-12-03
    Version         : 1.0
    CVEs            : CVE-2013-3900
    Plugin IDs      :166555
    STIG-ID         : N/A

.TESTED ON
    Date(s) Tested  : 
    Tested By       : 
    Systems Tested  : 
    PowerShell Ver. : 

.USAGE
    Put any usage instructions here.
    Example syntax:
    PS C:\> .\__remediation_template(STIG-ID-WN10-AU-000500).ps1 
#>

# # -------------------------------------------------------------
# EnableCertPaddingCheck Registry Configuration
# Adds/Enables the value under both 32-bit and 64-bit locations
# -------------------------------------------------------------

# Define registry paths
$RegPath32 = "HKLM:\Software\Microsoft\Cryptography\Wintrust\Config"
$RegPath64 = "HKLM:\Software\Wow6432Node\Microsoft\Cryptography\Wintrust\Config"

# Function to create path and enable registry value
function Set-CertPaddingCheck {
    param (
        [string]$Path
    )

    # Create key if it does not exist
    if (!(Test-Path $Path)) {
        New-Item -Path $Path -Force | Out-Null
    }

    # Create or update the registry value
    New-ItemProperty -Path $Path -Name "EnableCertPaddingCheck" -Value 1 -PropertyType DWORD -Force | Out-Null
}

Write-Host "Enabling Cert Padding Check..." -ForegroundColor Cyan

# Set value for 32-bit path (always present)
Set-CertPaddingCheck -Path $RegPath32

# Set value for 64-bit path (only if OS is 64-bit)
if ([Environment]::Is64BitOperatingSystem) {
    Set-CertPaddingCheck -Path $RegPath64
}

Write-Host "EnableCertPaddingCheck successfully configured on this system." -ForegroundColor Green
